name: ğŸš€ Deploy Frontend

on:
  push:
    branches: [ main ]
  workflow_dispatch:

jobs:
  deploy:
    runs-on: ubuntu-latest
    
    steps:
    - name: ğŸš€ Deploy to VPS
      uses: appleboy/ssh-action@master
      with:
        host: ${{ secrets.VPS_HOST }}
        username: ${{ secrets.VPS_USERNAME }}
        key: ${{ secrets.VPS_SSH_KEY }}
        port: ${{ secrets.VPS_PORT }}
        command_timeout: 10m
        script: |
          echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
          echo "ğŸš€ DÃ©ploiement LetUsSignFront"
          echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
          
          cd /var/www/letussign/frontend/LetUsSignFront
          
          echo "ğŸ“¥ Git pull..."
          git pull origin main
          
          echo "ğŸ“¦ Installation des dÃ©pendances..."
          npm ci --production
          
          echo "ğŸ”¨ Build..."
          npm run build
          
          echo "â™»ï¸ RedÃ©marrage PM2..."
          pm2 restart frontend || pm2 start npm --name "frontend" -- start
          pm2 save
          
          echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
          echo "âœ… DÃ©ploiement terminÃ© !"
          echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
          pm2 status
    
    - name: âœ… Success
      if: success()
      run: echo "ğŸ‰ Frontend dÃ©ployÃ© sur https://app.letussign.fr"
